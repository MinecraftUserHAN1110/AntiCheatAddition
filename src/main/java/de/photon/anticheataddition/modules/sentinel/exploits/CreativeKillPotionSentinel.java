package de.photon.anticheataddition.modules.sentinel.exploits;

import de.photon.anticheataddition.util.minecraft.entity.InternalPotion;
import org.bukkit.GameMode;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.potion.PotionEffect;
import org.bukkit.potion.PotionEffectType;

import java.util.Set;

public final class CreativeKillPotionSentinel extends IllegalPotionSentinel implements Listener
{
    public static final CreativeKillPotionSentinel INSTANCE = new CreativeKillPotionSentinel();

    private static final Set<PotionEffectType> ILLEGAL_POTION_TYPES = InternalPotion.getAvailablePotionTypes(InternalPotion.HEAL, InternalPotion.HARM);

    private CreativeKillPotionSentinel()
    {
        super("Exploits.CreativeKillPotion");
    }

    @Override
    protected boolean isIllegalPotion(PotionEffect effect)
    {
        // Important: Use equals here to check for the PotionEffectType, as that is NOT an Enum!
        return ILLEGAL_POTION_TYPES.contains(effect.getType()) && effect.getAmplifier() > 120;
    }

    @EventHandler
    public void onDamage(EntityDamageByEntityEvent e) {
        if (e.getDamager().getType() == EntityType.SPLASH_POTION) {
            if (e.getEntity() instanceof Player) {
                if (((Player) e.getEntity()).getGameMode() == GameMode.CREATIVE) {
                    e.setCancelled(true);
                }
            }
        }
    }
}
